# **1.2 Análisis de nulos y duplicados**

## NULOS: 

### ▫️ **Verificar valores nulos en la tabla host**

```sql
SELECT 
  COUNT(*) AS total_filas,
  SUM(CASE WHEN string_field_0 IS NULL THEN 1 ELSE 0 END) AS nulos_string_field_0,
  SUM(CASE WHEN string_field_1 IS NULL THEN 1 ELSE 0 END) AS nulos_string_field_1
FROM `proyecto-5-435916.data.hosts`;
```

![image](https://github.com/user-attachments/assets/3ab27cf9-5827-42a4-bc45-a5226801d88d)

#### Tratamiento:
* Reemplazaremos los valores nulos de host_name por un nombre genérico, como 'Unknown Host'.

```sql
CREATE OR REPLACE TABLE `proyecto-5-435916.data.hosts_cleaned` AS
SELECT
    CAST(host_id AS STRING) AS host_id,
    IFNULL(host_name, 'Unknown Host') AS host_name -- Reemplazar nulos con 'Unknown Host'
FROM
    `proyecto-5-435916.data.hosts`;
```

### ▫️ **Verificar valores nulos en la tabla rooms**
```sql
SELECT 
  COUNT(*) AS total_filas,
  SUM(CASE WHEN id IS NULL THEN 1 ELSE 0 END) AS nulos_id,
  SUM(CASE WHEN name IS NULL THEN 1 ELSE 0 END) AS nulos_name,
  SUM(CASE WHEN neighbourhood IS NULL THEN 1 ELSE 0 END) AS nulos_neighbourhood,
  SUM(CASE WHEN neighbourhood_group IS NULL THEN 1 ELSE 0 END) AS nulos_neighbourhood_group,
  SUM(CASE WHEN latitude IS NULL THEN 1 ELSE 0 END) AS nulos_latitude,
  SUM(CASE WHEN longitude IS NULL THEN 1 ELSE 0 END) AS nulos_longitude,
  SUM(CASE WHEN room_type IS NULL THEN 1 ELSE 0 END) AS nulos_room_type,
  SUM(CASE WHEN minimum_nights IS NULL THEN 1 ELSE 0 END) AS nulos_minimum_nights
FROM `proyecto-5-435916.data.rooms`;
```

![image](https://github.com/user-attachments/assets/23bdc45c-9ad6-409d-922d-1f62ab70c654)

Sin nulos


### ▫️ **Verificar valores nulos en la tabla reviews**

```sql
SELECT 
  COUNT(*) AS total_filas,
  SUM(CASE WHEN id IS NULL THEN 1 ELSE 0 END) AS nulos_id,
  SUM(CASE WHEN host_id IS NULL THEN 1 ELSE 0 END) AS nulos_host_id,
  SUM(CASE WHEN price IS NULL THEN 1 ELSE 0 END) AS nulos_price,
  SUM(CASE WHEN number_of_reviews IS NULL THEN 1 ELSE 0 END) AS nulos_number_of_reviews,
  SUM(CASE WHEN last_review IS NULL THEN 1 ELSE 0 END) AS nulos_last_review,
  SUM(CASE WHEN reviews_per_month IS NULL THEN 1 ELSE 0 END) AS nulos_reviews_per_month,
  SUM(CASE WHEN calculated_host_listings_count IS NULL THEN 1 ELSE 0 END) AS nulos_calculated_host_listings_count,
  SUM(CASE WHEN availability_365 IS NULL THEN 1 ELSE 0 END) AS nulos_availability_365
FROM `proyecto-5-435916.data.reviews`;
```

![image](https://github.com/user-attachments/assets/e28cbe7f-1818-4ecc-865e-2eae4223c9a0)

#### **Tratamiento** (Se realizo reemplazo de datos previamente para dejar todo como fecha, paso 1.3)
Manejar los valores nulos en las columnas reviews_per_month, number_of_reviews, y availability_365. 
* number_of_reviews: Reemplazamos con 0 si es nulo.
* reviews_per_month: Reemplazamos con 0.0 si es nulo.
* availability_365: Reemplazamos con 0 si es nulo.

```sql
CREATE OR REPLACE TABLE `proyecto-5-435916.data.reviews_final` AS
SELECT
    id,
    host_id,
    price,
    IFNULL(number_of_reviews, 0) AS number_of_reviews, -- Reemplazar nulos con 0 en las reseñas
    last_review,
    IFNULL(reviews_per_month, 0.0) AS reviews_per_month, -- Reemplazar nulos con 0.0 en las reseñas por mes
    calculated_host_listings_count,
    IFNULL(availability_365, 0) AS availability_365 -- Reemplazar nulos con 0 en la disponibilidad
FROM
    `proyecto-5-435916.data.reviews_cleaned`;
```
__________________________________________________
__________________________________________________

## DUPLICADOS 

### ▫️ **Verificar valores duplicados en la tabla host**

```sql
SELECT 
  string_field_0, 
  string_field_1, 
  COUNT(*) AS total_duplicados
FROM `proyecto-5-435916.data.Hosts`
GROUP BY string_field_0, string_field_1
HAVING total_duplicados > 1;
```

![image](https://github.com/user-attachments/assets/84ce04ac-6a89-4787-814c-f605060cf427)


### ▫️ **Verificar valores duplicados en la tabla rooms**

```sql
SELECT 
  id, 
  COUNT(*) AS total_duplicados
FROM `proyecto-5-435916.data.rooms`
GROUP BY id
HAVING total_duplicados > 1;
```

![image](https://github.com/user-attachments/assets/fd129d3f-0889-4c2e-b45e-063639bd3a07)



#### **Tratamiento**
Se eliminará duplicados y conservará la fila con el valor más alto de noches mínimas dentro de cada grupo de id

```sql
WITH RankedRooms AS (
    SELECT *,
        ROW_NUMBER() OVER (PARTITION BY id ORDER BY minimum_nights DESC) AS row_num
    FROM `proyecto-5-435916.data.rooms`
)
SELECT *
FROM RankedRooms
WHERE row_num = 1;
```


### ▫️ **Verificar valores duplicados en la tabla reviewa**

```sql
SELECT 
  id, 
  COUNT(*) AS total_duplicados
FROM `proyecto-5-435916.data.reviews`
GROUP BY id
HAVING total_duplicados > 1;
```

![image](https://github.com/user-attachments/assets/2d1b7765-b990-46c8-9b7e-234720b95344)


#### **Tratamiento**
En este caso se deciden mantener duplicados

